# 📌 模块交接说明：视频绑定通用目标（Video Target Binding）

## 一、模块目标（What & Why）

### 🎯 目标

实现一个 **“视频绑定任意业务对象”** 的通用机制，使平台中的视频不仅能绑定职位（JD），还可以绑定：

* 求职者简历视频（resume）
* 公司介绍视频（company_intro）
* 未来可扩展的任意内容（如 project、course、event 等）

### 🚫 非目标（明确不做的事）

* ❌ 不做视频推荐算法
* ❌ 不做前端页面
* ❌ 不实现复杂权限矩阵
* ❌ 不在 Video 表中加入具体业务字段（如 job_id / resume_id）

---

## 二、核心设计原则（必须遵守）

### 1️⃣ Video 是内容载体，不是业务实体

* Video **不关心**绑定对象的具体结构
* Video **不包含** Job / Resume / Company 的字段

### 2️⃣ 绑定对象通过“弱引用”实现

Video 表中仅允许以下字段：

```text
target_type: str   # 绑定对象类型（如 job / resume / company_intro）
target_id: int     # 绑定对象主键 ID
```

❌ 禁止：

* 多个外键
* JSON 存储完整对象
* 多态 ORM 继承

---

## 三、数据模型约束（Data Model Contract）

### Video 表（已存在）

```text
id
title
description
file_path
owner_id
target_type   (nullable)
target_id     (nullable)
```

### target_type 允许值（当前）

```text
job
resume
company_intro
```

> ⚠️ 不要求枚举硬编码在数据库
> ✅ 允许在 service 层维护映射关系

---

## 四、API 设计要求（强制）

### 1️⃣ 视频详情接口（必须实现）

```http
GET /video/{video_id}
```

#### 返回结构（强制遵守）

```json
{
  "id": 1,
  "title": "示例视频",
  "description": "...",
  "file_path": "/videos/xxx.mp4",
  "target": {
    "type": "resume",
    "label": "简历",
    "data": { }
  }
}
```

### 字段解释

| 字段           | 说明           |
| ------------ | ------------ |
| target.type  | 程序判断用        |
| target.label | 前端直接展示       |
| target.data  | **完整绑定对象数据** |

---

## 五、Target Resolver 设计说明（重点）

### 🎯 职责

实现一个**独立的解析服务**，用于：

* 视频详情页
* 视频流 feed
* 后续推荐系统

### 函数签名（建议）

```python
def resolve_target(
    target_type: str,
    target_id: int,
    db: Session
) -> dict | None
```

### 行为约束

* 若 target 不存在 → 返回 None
* 不抛异常（由调用方决定如何处理）
* 不直接依赖 FastAPI Request / Response

---

## 六、可扩展性要求（非常重要）

### 新增一个 target 类型时，必须满足：

✅ 不改 Video 表
✅ 不改已有接口返回结构
✅ 只需：

1. 新建业务表
2. 在 TargetResolver 中注册
3. 增加 label 映射

---

## 七、允许自由发挥的部分（Optional）

以下内容 **可做可不做**，不作为验收条件：

* target.data 是否做字段裁剪
* 是否使用 Pydantic 二次建模
* 是否缓存 target 解析结果
* 是否增加 target 不存在时的兜底提示

---

## 八、验收标准（Definition of Done）

以下全部满足才算完成：

* [ ] 视频可以不绑定任何 target
* [ ] 视频可以绑定 job / resume / company_intro
* [ ] `/video/{id}` 返回结构统一
* [ ] 新增 target 类型无需修改 Video 表
* [ ] Video 模块不 import 具体业务字段

---

## 九、设计哲学说明（供理解，不是代码要求）

> 我们构建的是 **“视频驱动的招聘平台”**
> 而不是 “招聘系统里加了视频字段”

因此：

* Video 是一等公民
* Job / Resume 是被视频表达的对象
* AI 能理解的是 **内容 + 语义绑定**

---

## 十、交接备注（给其他大模型）

* 不要过度工程化
* 不要为了“优雅”破坏解耦
* 不要提前为推荐系统设计 schema
