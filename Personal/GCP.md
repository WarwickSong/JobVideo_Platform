智能临床试验入排筛选系统（合并总结版）

一、项目概述

智能临床试验入排筛选系统是一个基于 Multi-Agent 架构的医疗数据智能检索平台，核心目标是将自然语言描述的临床试验入排标准自动转换为 SQL 查询，并结合大语言模型（LLM）实现智能患者筛选。系统通过自然语言处理、向量检索和数据库查询等核心技术，大幅提高临床试验患者筛选的效率和准确性，有效解决传统人工筛选耗时费力、易遗漏、误判率高的行业痛点；同时实现面向大规模患者数据的自动化筛选与决策，覆盖从条件处理到结果输出的端到端全流程，已在深圳某区级医疗平台完成部署并投入使用。

二、核心功能与项目要点

（一）自然语言到 SQL 转换

- 条件筛选与拆分：智能判断入排条件是否可通过 SQL 查询检索，清晰区分结构化数据查询和非结构化文本判断；可将复杂的复合条件自动拆分为独立的原子条件，便于分步骤处理，提升流程规范性。
- 两阶段 Schema 检索：基于 FAISS 向量相似度搜索，构建表级+字段级两阶段检索机制，从大规模数据库 Schema 中精准匹配相关字段，每表限制 top-k 列，兼顾检索相关性与可控性。
- 增强型 SQL 生成：根据检索到的 Schema 信息和条件描述，生成符合 MySQL 等主流数据库规范的 SQL 查询语句；采用增强重试机制，记录失败 SQL 与优化建议，迭代提示词生成，输出时通过 sqlparse 进行规范化格式化，确保 SQL 可执行性。

（二）智能患者筛选

- SQL 执行与冗余检查：自动执行生成的 SQL 查询，快速获取符合条件的患者列表；内置冗余条件检测模块，对 SQL 覆盖度给出量化评估（coverage + residual_text），精准识别无法通过 SQL 覆盖的残留条件。
- 补充处理与患者判定：对残留条件进行 Schema 适配，尝试生成补充 SQL 查询；针对仍无法覆盖的条件，使用 LLM 进行逐患者智能判断，对超长患者信息采用“关键词抽取→key-value 相关检索→embedding 排序截断”的分层过滤方式，控制输入长度并提升判定准确性，同时返回详细判断结果。

（三）决策与目标管理

- 智能决策机制：根据 SQL 筛选出的患者人数和目标人数，智能判断筛查规模；使用 LLM 预估可入组患者占当前患者的比例，自动决策下一步操作（用户手动修改或 LLM 自动排查），适配不同业务场景需求。
- 全流程目标管理：管理招募目标、每日招募数据提交，提供招募趋势预测和完成时间预估；集成缓存管理能力，支持筛选过程复用、结果保存与加载，适配实际医疗平台业务流程。

（四）RECIST 1.1 疗效评估

- 标准化疗效评估：严格遵循 RECIST 1.1 标准，自动完成靶病灶选择；计算基线和随访测量值的变化率，自动判断疗效类别（CR、PR、SD、PD），确保评估结果的规范性和准确性。
- 新病灶检测：自动识别患者检查中的新病灶，一旦检测到新病灶直接判定为 PD，简化评估流程，减少人工干预。

（五）混合字段结构化抽取

- 模板生成与抽取能力：基于无标注样例自动生成结构化抽取模板，支持单条或批量抽取混合字段中的结构化信息，适配不同数据量需求。
- 稳定性保障：自动分离冗余信息，返回格式化统一的抽取结果；内置缺失字段回退与冗余信息回填机制，大幅提升抽取过程的稳定性和结果完整性。

（六）核心项目要点提炼

- 设计 Multi-Agent 流水线，覆盖条件筛选、拆分、Schema 检索、SQL 生成/冗余校验、患者判定与结构化抽取，实现端到端自动筛选流程。
- 构建完善的 Schema 语义检索与 SQL 生成链路，结合两阶段检索和增强重试机制，确保 SQL 生成的准确性和可执行性。
- 引入冗余条件检测与补充处理机制，结合 LLM 分层过滤判定，全面覆盖结构化与非结构化条件，提升筛选完整性。
- 集成缓存管理与目标管理能力，适配实际医疗平台业务流程，支持筛选过程复用和入组进度管控。
- 量化成果：已在深圳某区级医疗平台完成部署并投入使用，实现临床患者筛选效率与准确性的双重提升。

三、技术架构

（一）Multi-Agent 架构设计

系统采用模块化 Multi-Agent 架构，将整个筛选流程分解为多个独立的处理模块，每个模块由专门的 Agent 负责，通过标准化接口协同工作，结构清晰、易于维护和扩展，具体包含以下核心 Agent：

- ConditionFilter Agent：负责入排条件的筛选与分类
- ConditionSplitter Agent：负责复杂复合条件的拆分
- SchemaRetriever Agent：负责 Schema 的两阶段向量检索
- SQLGenerator Agent：负责 SQL 查询语句的生成与优化
- RedundancyChecker Agent：负责 SQL 覆盖度的冗余检查
- SchemaAdapter Agent：负责残留条件的 Schema 适配
- SupplementarySQLGenerator Agent：负责补充 SQL 的生成
- PatientJudger Agent：负责残余条件的逐患者智能判定
- TargetManager Agent：负责招募目标与进度的管理
- RecistEvaluator Agent：负责遵循 RECIST 1.1 标准的疗效评估
- ComposedSchemaExtractor Agent：负责混合字段的结构化抽取

（二）处理流程

入排条件输入 → 条件筛选 → 条件拆分 → Schema 检索（表级→字段级） → SQL 生成（含重试优化） → SQL 执行 → 冗余检查 → 补充 SQL 生成（残留条件适配） → 患者判断（LLM 分层过滤） → 疗效评估（可选） → 结果输出

四、关键技术栈

- 后端框架：FastAPI（高性能 Web 框架，提供 RESTful API）、Pydantic（数据验证和序列化）、Uvicorn（ASGI 服务器）
- 核心技术：FAISS（向量相似度搜索，支持大规模 Schema 检索）、LLM（SiliconFlow 等大语言模型，用于智能判断和文本生成）、Embedding（文本向量化，支持语义匹配）、SQL（MySQL 等关系型数据库查询）
- 工具库：NumPy（数值计算）、Requests（HTTP 请求）、PyYAML（配置文件解析）、SQLParse（SQL 解析和格式化）

简历精简版技术栈（一行适配）：Python / LLM / Multi-Agent / 向量检索(FAISS) / SQL 生成 / sqlparse / Pydantic / YAML

五、技术亮点

- 两阶段 Schema 检索：先检索相关表，再从匹配的表中检索相关字段，基于向量相似度搜索支持大规模 Schema 库，可配置相似度阈值和返回数量，兼顾效率与准确性。
- 增强的 SQL 生成机制：支持多次重试，记录失败经验并优化，自动格式化和验证 SQL 语句，大幅提高 SQL 生成成功率和可执行性。
- 智能决策系统：根据筛查规模自动选择处理策略，支持可入组比例预估，搭配灵活的缓存机制，支持结果保存和加载，适配实际业务场景。
- 模块化设计：清晰的模块划分，统一的接口设计，模块间协作顺畅，易于维护、扩展，支持独立测试和替换特定模块，提升系统灵活性。
- 完整的 API 接口：采用 RESTful API 设计，易于与其他系统集成，覆盖条件处理、SQL 生成、决策判断、患者判断、结构化抽取、缓存管理等全功能，具备完善的错误处理和日志记录。
- 患者判定优化：通过分层过滤机制处理超长患者信息，在控制输入长度的同时提升判定准确性，兼顾效率与精度。

六、应用场景

- 临床试验患者筛选：自动筛选符合入排条件的患者，替代人工筛选，提升效率和准确性，降低误判、遗漏风险。
- 专病库构建：从海量医疗数据库中快速提取特定疾病患者信息，助力专病研究与数据积累。
- 医疗数据检索：支持基于自然语言的医疗数据查询，无需专业人员编写 SQL，降低医疗数据检索门槛。
- 疗效评估：根据 RECIST 1.1 标准自动评估肿瘤患者疗效，规范评估流程，减少人工干预。
- 数据结构化：从混合字段（含非结构化信息）中提取结构化数据，统一数据格式，助力医疗数据的后续分析与利用。

七、项目成果

- 实现了从自然语言到 SQL 的端到端自动化流程，覆盖临床试验入排筛选全环节，彻底解决传统人工筛选的痛点。
- 构建了完整的 Multi-Agent 架构实现，模块化设计清晰，支持扩展与独立替换，具备较强的复用性和可维护性。
- 支持大规模患者数据库的智能筛选，结合两阶段 Schema 检索、增强 SQL 生成和 LLM 分层判定，确保筛选的准确性、完整性和效率。
- 集成疗效评估、混合字段结构化抽取、目标管理等增值功能，形成多元化解决方案，适配医疗行业多场景需求。
- 已在深圳某区级医疗平台完成部署并投入使用，经过实际场景验证，有效提升临床患者筛选效率和准确性，具备较高的实用价值。
- 形成了标准化的技术链路和 API 接口，便于与其他医疗系统集成，为后续产品化、规模化推广奠定基础。

八、简历适配删减建议

- 更精简版本：保留项目概述核心目标与量化成果、核心功能中的 SQL 转换+智能筛选、技术亮点（两阶段检索+增强 SQL 生成）、项目成果核心要点，简化技术架构和工具库细节。
- 突出技术能力：保留 Multi-Agent 架构、核心技术栈、技术亮点全内容，合并核心功能要点，弱化应用场景，重点体现技术实现能力。
- 强调业务价值：保留项目概述、应用场景、项目成果（重点突出部署应用情况），简化技术细节，合并核心功能，突出系统对临床工作的实际提升作用。
